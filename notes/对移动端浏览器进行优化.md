# 对移动端浏览器进行优化

下载器是基于 pixiv 的桌面端网站开发的，一些功能并没有对移动端页面进行优化。现在打算优化一下。

## 通过 UA 判断是否处于移动端模式

Kiwi 浏览器移动端的 UA 是这样的：

```
Mozilla/5.0 (Linux; Android 10; MI 8) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Mobile Safari/537.36
```

切换为桌面版网站时是这样的：

```
Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36
```

两个主要区别：
1. 移动端的操作系统是 Android，桌面端是 Linux
2. 移动端有 Mobile 标志，桌面端没有

可以通过 `navigator.userAgent.includes('Mobile')` 判断是否是移动端，并且 Chrome 浏览器在切换为移动端调试时也有这个标记，例如：

```
Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Mobile Safari/537.36
```

## 点击收藏按钮、点赞按钮时下载作品

之前在移动端页面点击收藏按钮、点赞按钮时，下载器无法监听到对应事件，这是因为下载器压根没有获取到对应元素。

现在我在 `WorkToolBar` 类里添加 `getElementsOnMobile` 方法，处理移动端的工具栏按钮，是这两个功能正常了。

## 快速收藏按钮及联动效果

修复了在移动端快速收藏按钮功能不正常的问题，以及导致其他相关按钮样式或功能异常的问题。

## 识别主题颜色

移动端的主题颜色是 body 上的 class，如果含有 dark 就是夜间模式，如果没有 dark 就是白色模式。

现在进行了适配。
